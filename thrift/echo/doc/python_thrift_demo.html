<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="no-js ie6" lang="zh_CN"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js ie7" lang="zh_CN"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8" lang="zh_CN"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html> <!--<![endif]-->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!--<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;"/>-->
<meta name="viewport" content="width=1024" />


<title>笔记：Ubuntu下快速开始使用Python Thrift | 孙立文的博客</title>

<!-- <link rel="stylesheet" href="http://sunliwen.com/wp-content/themes/wam/style.css" type="text/css" media="screen" /> -->
<link rel="stylesheet" type="text/css" href="//sunliwen.com/wp-content/cache/wpfc-minified/c1105b76b5fd857c785242b2079e6d42/1503271012index.css" media="screen"/>

<!-- <link rel="stylesheet" href="http://sunliwen.com/wp-content/themes/wam/print.css" type="text/css" media="print" /> -->
<link rel="stylesheet" type="text/css" href="//sunliwen.com/wp-content/cache/wpfc-minified/86591b9b1e7a0bc6518dfc4cec4fec3e/1503271012index.css" media="print"/>

<link rel="alternate" type="application/rss+xml" title="孙立文的博客 RSS Feed" href="http://sunliwen.com/feed/" />
<link rel="pingback" href="http://sunliwen.com/xmlrpc.php" />

<!-- SEO Ultimate (http://www.seodesignsolutions.com/wordpress-seo/) -->
	<link rel="canonical" href="http://sunliwen.com/2012/02/apache-thrift-on-ubuntu-10-04/" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="笔记：Ubuntu下快速开始使用Python Thrift" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="http://sunliwen.com/2012/02/apache-thrift-on-ubuntu-10-04/" />
	<meta prefix="article: http://ogp.me/ns/article#" property="article:published_time" content="2012-02-08" />
	<meta prefix="article: http://ogp.me/ns/article#" property="article:modified_time" content="2013-03-17" />
	<meta prefix="article: http://ogp.me/ns/article#" property="article:author" content="http://sunliwen.com/author/liwen/" />
	<meta prefix="article: http://ogp.me/ns/article#" property="article:section" content="Uncategorized" />
	<meta prefix="article: http://ogp.me/ns/article#" property="article:tag" content="Apache Thrift" />
	<meta prefix="article: http://ogp.me/ns/article#" property="article:tag" content="Python" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="孙立文的博客" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:creator" content="@slw4qd" />
	<meta name="twitter:site" content="@slw4qd" />
	<meta name="twitter:site:id" content="slw4qd" />
	<meta name="twitter:creator:id" content="slw4qd" />
<!-- /SEO Ultimate -->

<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="孙立文的博客 &raquo; 笔记：Ubuntu下快速开始使用Python Thrift评论Feed" href="http://sunliwen.com/2012/02/apache-thrift-on-ubuntu-10-04/feed/" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v6.2.3 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<script type="text/javascript" data-cfasync="false">
		var disableStr = 'ga-disable-UA-565717-10';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-565717-10', 'auto', {'allowAnchor':true,'allowLinker':true});
	__gaTracker('set', 'forceSSL', true);
	__gaTracker('set', 'anonymizeIp', true);
	__gaTracker('require', 'displayfeatures');
	__gaTracker('require', 'linkid', 'linkid.js');
	__gaTracker('send','pageview', location.pathname + location.search + location.hash);
</script>
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/sunliwen.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=fe7b40731312a61df5cf19937a0ef419"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<!-- <link rel='stylesheet' id='wp-syntax-css-css'  href='http://sunliwen.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.1' type='text/css' media='all' /> -->
<link rel="stylesheet" type="text/css" href="//sunliwen.com/wp-content/cache/wpfc-minified/a519b9dc907509ac36b1e0f92a1a226d/1503271012index.css" media="all"/>
<script type='text/javascript'>
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","is_debug_mode":"false","download_extensions":"doc,exe,js,pdf,ppt,tgz,zip,xls","inbound_paths":"","home_url":"http:\/\/sunliwen.com","track_download_as":"event","internal_label":"int","hash_tracking":"true"};
/* ]]> */
</script>
<script src='//sunliwen.com/wp-content/cache/wpfc-minified/09001a7ade226db69fa973380ccbb442/1506825569index.js' type="text/javascript"></script>
<!-- <script type='text/javascript' src='http://sunliwen.com/wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend.min.js?ver=6.2.3'></script> -->
<!-- <script type='text/javascript' src='http://sunliwen.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script> -->
<!-- <script type='text/javascript' src='http://sunliwen.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script> -->
<link rel='https://api.w.org/' href='http://sunliwen.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://sunliwen.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://sunliwen.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='ab(Apache Benchmark)运行apr_socket_recv报错' href='http://sunliwen.com/2012/01/mac-ab-apr-error/' />
<link rel='next' title='Ubuntu下用Vim编辑且不改变GBK编码的文件' href='http://sunliwen.com/2012/03/ubuntu-vim-gbk/' />

<link rel='shortlink' href='http://sunliwen.com/?p=1967' />
<link rel="alternate" type="application/json+oembed" href="http://sunliwen.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fsunliwen.com%2F2012%2F02%2Fapache-thrift-on-ubuntu-10-04%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://sunliwen.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fsunliwen.com%2F2012%2F02%2Fapache-thrift-on-ubuntu-10-04%2F&#038;format=xml" />
<!-- SEO by Meta Keywords Generator : techphernalia.com v1.11 start-->
<meta name="keywords" content="笔记：Ubuntu下快速开始使用Python Thrift, 笔记：Ubuntu下快速开始使用Python, Thrift, 孙立文的博客, Uncategorized, Apache Thrift, Python, linux, python, django, restful, saas, product design, mvp, minimal viable product, 产品设计, 数据分析, 推荐系统, 搜索引擎, lucene, elasticsearch, docker" />
<meta name="description" content="本文介绍如何在Ubuntu 10.04下安装Apache Thrift并用Python写一个Demo。


apt-get install libboost-dev libevent-dev python-dev automake pkg-config libtool flex bison sun-java6-jdk
wget htt" />
<!-- SEO by Meta Keywords Generator : techphernalia.com v1.1 end-->
<script type="text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//sunliwen.com/?wordfence_lh=1&hid=5C27C658726D763C24E65877EE2EA06D');
</script><meta name="keywords" content="Apache Thrift, Python" />
<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09F}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style><style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(45,53,63,.88);}</style></head>
<body>
<div id="page">

<div id="header">
	<div id="headerimg">
		<h1><a href="http://sunliwen.com/">孙立文的博客</a></h1>
		<div class="description">Leading the new way to work!</div>
	</div>
</div>
<hr />

	<div id="content" class="widecolumn">

	
		<div class="navigation">
			<div class="alignleft">&laquo; <a href="http://sunliwen.com/2012/01/mac-ab-apr-error/" rel="prev">ab(Apache Benchmark)运行apr_socket_recv报错</a></div>
			<div class="alignright"><a href="http://sunliwen.com/2012/03/ubuntu-vim-gbk/" rel="next">Ubuntu下用Vim编辑且不改变GBK编码的文件</a> &raquo;</div>
		</div>

		<div class="post" id="post-1967">
			<h2>笔记：Ubuntu下快速开始使用Python Thrift</h2>

			<div class="entry">
				<p>本文介绍如何在Ubuntu 10.04下安装Apache Thrift并用Python写一个Demo。</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">apt-get install</span> libboost-dev libevent-dev python-dev <span style="color: #c20cb9; font-weight: bold;">automake</span> pkg-config libtool <span style="color: #c20cb9; font-weight: bold;">flex</span> <span style="color: #c20cb9; font-weight: bold;">bison</span> sun-java6-jdk
<span style="color: #c20cb9; font-weight: bold;">wget</span> http:<span style="color: #000000; font-weight: bold;">//</span>www.apache.org<span style="color: #000000; font-weight: bold;">/</span>dist<span style="color: #000000; font-weight: bold;">//</span>thrift<span style="color: #000000; font-weight: bold;">/</span>0.8.0<span style="color: #000000; font-weight: bold;">/</span>thrift-0.8.0.tar.gz
<span style="color: #c20cb9; font-weight: bold;">tar</span> zxvf thrift-0.8.0.tar.gz
<span style="color: #7a0874; font-weight: bold;">cd</span> thrift-0.8.0
.<span style="color: #000000; font-weight: bold;">/</span>configure
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> pip <span style="color: #c20cb9; font-weight: bold;">install</span> thrift</pre></td></tr></table><p class="theCode" style="display:none;">apt-get install libboost-dev libevent-dev python-dev automake pkg-config libtool flex bison sun-java6-jdk
wget http://www.apache.org/dist//thrift/0.8.0/thrift-0.8.0.tar.gz
tar zxvf thrift-0.8.0.tar.gz
cd thrift-0.8.0
./configure
make
sudo make install
sudo pip install thrift</p></div>

<p>编辑接口文件 hellowworld.thrift:</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="thrift" style="font-family:monospace;">service HelloWorld {
    string ping(),
    string say(1:string msg)
}</pre></td></tr></table><p class="theCode" style="display:none;">service HelloWorld {
    string ping(),
    string say(1:string msg)
}</p></div>

<p>编辑 server.py</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">socket</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
<span style="color: #dc143c;">sys</span>.<span style="color: black;">path</span>.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'./gen-py'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> helloworld <span style="color: #ff7700;font-weight:bold;">import</span> HelloWorld
<span style="color: #ff7700;font-weight:bold;">from</span> helloworld.<span style="color: black;">ttypes</span> <span style="color: #ff7700;font-weight:bold;">import</span> *
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> thrift.<span style="color: black;">transport</span> <span style="color: #ff7700;font-weight:bold;">import</span> TSocket
<span style="color: #ff7700;font-weight:bold;">from</span> thrift.<span style="color: black;">transport</span> <span style="color: #ff7700;font-weight:bold;">import</span> TTransport
<span style="color: #ff7700;font-weight:bold;">from</span> thrift.<span style="color: black;">protocol</span> <span style="color: #ff7700;font-weight:bold;">import</span> TBinaryProtocol
<span style="color: #ff7700;font-weight:bold;">from</span> thrift.<span style="color: black;">server</span> <span style="color: #ff7700;font-weight:bold;">import</span> TServer
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> HelloWorldHandler:
  <span style="color: #ff7700;font-weight:bold;">def</span> ping<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;pong&quot;</span>
&nbsp;
  <span style="color: #ff7700;font-weight:bold;">def</span> say<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> msg<span style="color: black;">&#41;</span>:
    ret <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">&quot;Received: &quot;</span> + msg
    <span style="color: #ff7700;font-weight:bold;">print</span> ret
    <span style="color: #ff7700;font-weight:bold;">return</span> ret
&nbsp;
handler <span style="color: #66cc66;">=</span> HelloWorldHandler<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
processor <span style="color: #66cc66;">=</span> HelloWorld.<span style="color: black;">Processor</span><span style="color: black;">&#40;</span>handler<span style="color: black;">&#41;</span>
transport <span style="color: #66cc66;">=</span> TSocket.<span style="color: black;">TServerSocket</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;localhost&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">9090</span><span style="color: black;">&#41;</span>
tfactory <span style="color: #66cc66;">=</span> TTransport.<span style="color: black;">TBufferedTransportFactory</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
pfactory <span style="color: #66cc66;">=</span> TBinaryProtocol.<span style="color: black;">TBinaryProtocolFactory</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
server <span style="color: #66cc66;">=</span> TServer.<span style="color: black;">TSimpleServer</span><span style="color: black;">&#40;</span>processor<span style="color: #66cc66;">,</span> transport<span style="color: #66cc66;">,</span> tfactory<span style="color: #66cc66;">,</span> pfactory<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Starting thrift server in python...&quot;</span>
server.<span style="color: black;">serve</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;done!&quot;</span></pre></td></tr></table><p class="theCode" style="display:none;">#!/usr/bin/env python

import socket
import sys
sys.path.append('./gen-py')

from helloworld import HelloWorld
from helloworld.ttypes import *

from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol
from thrift.server import TServer

class HelloWorldHandler:
  def ping(self):
    return &quot;pong&quot;

  def say(self, msg):
    ret = &quot;Received: &quot; + msg
    print ret
    return ret

handler = HelloWorldHandler()
processor = HelloWorld.Processor(handler)
transport = TSocket.TServerSocket(&quot;localhost&quot;, 9090)
tfactory = TTransport.TBufferedTransportFactory()
pfactory = TBinaryProtocol.TBinaryProtocolFactory()

server = TServer.TSimpleServer(processor, transport, tfactory, pfactory)

print &quot;Starting thrift server in python...&quot;
server.serve()
print &quot;done!&quot;</p></div>

<p>编辑 client.py</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
<span style="color: #dc143c;">sys</span>.<span style="color: black;">path</span>.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'./gen-py'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> helloworld <span style="color: #ff7700;font-weight:bold;">import</span> HelloWorld
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> thrift <span style="color: #ff7700;font-weight:bold;">import</span> Thrift
<span style="color: #ff7700;font-weight:bold;">from</span> thrift.<span style="color: black;">transport</span> <span style="color: #ff7700;font-weight:bold;">import</span> TSocket
<span style="color: #ff7700;font-weight:bold;">from</span> thrift.<span style="color: black;">transport</span> <span style="color: #ff7700;font-weight:bold;">import</span> TTransport
<span style="color: #ff7700;font-weight:bold;">from</span> thrift.<span style="color: black;">protocol</span> <span style="color: #ff7700;font-weight:bold;">import</span> TBinaryProtocol
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
  transport <span style="color: #66cc66;">=</span> TSocket.<span style="color: black;">TSocket</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'localhost'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">9090</span><span style="color: black;">&#41;</span>
  transport <span style="color: #66cc66;">=</span> TTransport.<span style="color: black;">TBufferedTransport</span><span style="color: black;">&#40;</span>transport<span style="color: black;">&#41;</span>
  protocol <span style="color: #66cc66;">=</span> TBinaryProtocol.<span style="color: black;">TBinaryProtocol</span><span style="color: black;">&#40;</span>transport<span style="color: black;">&#41;</span>
  client <span style="color: #66cc66;">=</span> HelloWorld.<span style="color: black;">Client</span><span style="color: black;">&#40;</span>protocol<span style="color: black;">&#41;</span>
  transport.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
  <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;client - ping&quot;</span>
  <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;server - &quot;</span> + client.<span style="color: black;">ping</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
  <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;client - say&quot;</span>
  msg <span style="color: #66cc66;">=</span> client.<span style="color: black;">say</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Hello!&quot;</span><span style="color: black;">&#41;</span>
  <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;server - &quot;</span> + msg
&nbsp;
  transport.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">except</span> Thrift.<span style="color: black;">TException</span><span style="color: #66cc66;">,</span> ex:
  <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;%s&quot;</span> % <span style="color: black;">&#40;</span>ex.<span style="color: black;">message</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">#!/usr/bin/env python

import sys
sys.path.append('./gen-py')

from helloworld import HelloWorld

from thrift import Thrift
from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol

try:
  transport = TSocket.TSocket('localhost', 9090)
  transport = TTransport.TBufferedTransport(transport)
  protocol = TBinaryProtocol.TBinaryProtocol(transport)
  client = HelloWorld.Client(protocol)
  transport.open()

  print &quot;client - ping&quot;
  print &quot;server - &quot; + client.ping()

  print &quot;client - say&quot;
  msg = client.say(&quot;Hello!&quot;)
  print &quot;server - &quot; + msg

  transport.close()

except Thrift.TException, ex:
  print &quot;%s&quot; % (ex.message)</p></div>


<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">thrift <span style="color: #660033;">--gen</span> py helloworld.thrift
python server.py
python client.py</pre></td></tr></table><p class="theCode" style="display:none;">thrift --gen py helloworld.thrift
python server.py
python client.py</p></div>

<p>参考: <a href="http://diwakergupta.github.com/thrift-missing-guide/thrift.pdf">Thrift the missing guide</a></p>
<div class="su-linkbox" id="post-1967-linkbox"><div class="su-linkbox-label">Link to this post!</div><div class="su-linkbox-field"><input type="text" value="&lt;a href=&quot;http://sunliwen.com/2012/02/apache-thrift-on-ubuntu-10-04/&quot;&gt;笔记：Ubuntu下快速开始使用Python Thrift&lt;/a&gt;" onclick="javascript:this.select()" readonly="readonly" style="width: 100%;" /></div></div>
								<p id="tags">标签: <a href="http://sunliwen.com/tag/apache-thrift/" rel="tag">Apache Thrift</a>, <a href="http://sunliwen.com/tag/python/" rel="tag">Python</a></p>
				<p class="postmetadata alt">
					<small>
												    发表于2012年2月8日					        <a href="http://sunliwen.com/2012/02/apache-thrift-on-ubuntu-10-04/feed/">订阅评论</a>,

													<a href="#respond">发表评论</a>, 或<a href="http://sunliwen.com/2012/02/apache-thrift-on-ubuntu-10-04/trackback/" rel="trackback">引用本文</a> .

						
					</small>
				</p>

			</div>
		</div>

	
<div id="disqus_thread">
            <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="comment even thread-even depth-1" id="dsq-comment-1913">
        <div id="dsq-comment-header-1913" class="dsq-comment-header">
            <cite id="dsq-cite-1913">
                <span id="dsq-author-user-1913">Lycc316</span>
            </cite>
        </div>
        <div id="dsq-comment-body-1913" class="dsq-comment-body">
            <div id="dsq-comment-message-1913" class="dsq-comment-message"><p>使用这个py服务端，java的客户端时有问题！</p>
<p>py服务器运行后使用netstat -na | grep 9090<br />
transport = TSocket.TServerSocket(&#8220;localhost&#8221;, 9090)<br />
此对应输出为：tcp        0      0 ::1:9090                    :::*                        LISTEN </p>
<p>此时用java的客户端时显示Connection refuse!<br />
应改为transport = TSocket.TServerSocket(port= 9090)<br />
此对应输出为：tcp        0      0 :::9090                     :::*                        LISTEN </p>
<p>这样java客户端才能正常连接到，原因表现为不同的ip在监听，但根本原因是什么还不了解，希望知道的指导一下！  </p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-1914">
        <div id="dsq-comment-header-1914" class="dsq-comment-header">
            <cite id="dsq-cite-1914">
                <a id="dsq-author-user-1914" href="http://sunliwen.com" target="_blank" rel="nofollow">Sun, Liwen</a>
            </cite>
        </div>
        <div id="dsq-comment-body-1914" class="dsq-comment-body">
            <div id="dsq-comment-message-1914" class="dsq-comment-message"><p>执行以下下面的命令看一眼？</p>
<p>sudo cat /etc/hosts </p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
            </ul>


        </div>

    </div>

<script type="text/javascript">
var disqus_url = 'http://sunliwen.com/2012/02/apache-thrift-on-ubuntu-10-04/';
var disqus_identifier = '1967 http://sunliwen.com/?p=1967';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'sunliwen';
var disqus_title = "笔记：Ubuntu下快速开始使用Python Thrift";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
    /*
    All currently supported events:
    onReady: fires when everything is ready,
    onNewComment: fires when a new comment is posted,
    onIdentify: fires when user is authenticated
    */
    
    
    this.language = '';
        this.callbacks.onReady.push(function () {

        // sync comments in the background so we don't block the page
        var script = document.createElement('script');
        script.async = true;
        script.src = '?cf_action=sync_comments&post_id=1967';

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    });
    
    if (disqus_config_custom) {
        disqus_config_custom.call(this);
    }
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>


	
	</div>
	
		<div id="sidebar">
		<ul>
			<li id="nktagcloud-3" class="widget widget_nktagcloud"><h2 class="widgettitle">标签</h2><a href='http://sunliwen.com/tag/linux/'  class='tag-link-60 nktagcloud-18' title='10' rel="tag" style='font-size: 18pt;'>Linux</a>
<a href='http://sunliwen.com/tag/python/'  class='tag-link-144 nktagcloud-12' title='6' rel="tag" style='font-size: 12.67pt;'>Python</a>
<a href='http://sunliwen.com/tag/java/'  class='tag-link-43 nktagcloud-11' title='5' rel="tag" style='font-size: 11.33pt;'>Java</a>
<a href='http://sunliwen.com/tag/misc/'  class='tag-link-28 nktagcloud-10' title='4' rel="tag" style='font-size: 10pt;'>Misc</a>
<a href='http://sunliwen.com/tag/clr/'  class='tag-link-142 nktagcloud-10' title='4' rel="tag" style='font-size: 10pt;'>CLR</a>
<a href='http://sunliwen.com/tag/hci/'  class='tag-link-24 nktagcloud-10' title='4' rel="tag" style='font-size: 10pt;'>交互</a>
<a href='http://sunliwen.com/tag/mono/'  class='tag-link-18 nktagcloud-10' title='4' rel="tag" style='font-size: 10pt;'>Mono</a>
<a href='http://sunliwen.com/tag/nginx/'  class='tag-link-186 nktagcloud-8' title='3' rel="tag" style='font-size: 8.67pt;'>Nginx</a>
<a href='http://sunliwen.com/tag/mac/'  class='tag-link-202 nktagcloud-8' title='3' rel="tag" style='font-size: 8.67pt;'>Mac</a>
<a href='http://sunliwen.com/tag/ops/'  class='tag-link-187 nktagcloud-8' title='3' rel="tag" style='font-size: 8.67pt;'>Ops</a>
<a href='http://sunliwen.com/tag/activities/'  class='tag-link-196 nktagcloud-8' title='3' rel="tag" style='font-size: 8.67pt;'>活动</a>
<a href='http://sunliwen.com/tag/idea/'  class='tag-link-53 nktagcloud-8' title='3' rel="tag" style='font-size: 8.67pt;'>想法</a>
<a href='http://sunliwen.com/tag/tools/'  class='tag-link-13 nktagcloud-8' title='3' rel="tag" style='font-size: 8.67pt;'>Tools</a>
<a href='http://sunliwen.com/tag/testing/'  class='tag-link-27 nktagcloud-8' title='3' rel="tag" style='font-size: 8.67pt;'>Testing</a>
<a href='http://sunliwen.com/tag/2006/'  class='tag-link-32 nktagcloud-8' title='3' rel="tag" style='font-size: 8.67pt;'>2006</a>
<a href='http://sunliwen.com/tag/metrics/'  class='tag-link-195 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>Metrics</a>
<a href='http://sunliwen.com/tag/system-analytics/'  class='tag-link-201 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>系分</a>
<a href='http://sunliwen.com/tag/toy/'  class='tag-link-199 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>玩意</a>
<a href='http://sunliwen.com/tag/http/'  class='tag-link-210 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>HTTP</a>
<a href='http://sunliwen.com/tag/php/'  class='tag-link-188 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>PHP</a>
<a href='http://sunliwen.com/tag/vim/'  class='tag-link-149 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>VIM</a>
<a href='http://sunliwen.com/tag/mercurial/'  class='tag-link-153 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>Mercurial</a>
<a href='http://sunliwen.com/tag/javascript/'  class='tag-link-59 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>Javascript</a>
<a href='http://sunliwen.com/tag/vps/'  class='tag-link-150 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>VPS</a>
<a href='http://sunliwen.com/tag/ramhost/'  class='tag-link-151 nktagcloud-7' title='2' rel="tag" style='font-size: 7.33pt;'>RAMHost</a>
<a href='http://sunliwen.com/tag/debug/'  class='tag-link-12 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Debug</a>
<a href='http://sunliwen.com/tag/vpn/'  class='tag-link-184 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>VPN</a>
<a href='http://sunliwen.com/tag/healthcare/'  class='tag-link-21 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Healthcare</a>
<a href='http://sunliwen.com/tag/uml/'  class='tag-link-22 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>UML</a>
<a href='http://sunliwen.com/tag/apache/'  class='tag-link-231 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Apache</a>
<a href='http://sunliwen.com/tag/mindmap/'  class='tag-link-198 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>思维导图</a>
<a href='http://sunliwen.com/tag/gossip/'  class='tag-link-197 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>八卦</a>
<a href='http://sunliwen.com/tag/mapreduce/'  class='tag-link-193 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>MapReduce</a>
<a href='http://sunliwen.com/tag/nosql/'  class='tag-link-194 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>NoSQL</a>
<a href='http://sunliwen.com/tag/ab/'  class='tag-link-232 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>AB</a>
<a href='http://sunliwen.com/tag/web/'  class='tag-link-235 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Web</a>
<a href='http://sunliwen.com/tag/geek/'  class='tag-link-254 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Geek</a>
<a href='http://sunliwen.com/tag/neo4j/'  class='tag-link-253 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Neo4j</a>
<a href='http://sunliwen.com/tag/homebrew/'  class='tag-link-252 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Homebrew</a>
<a href='http://sunliwen.com/tag/apache-thrift/'  class='tag-link-236 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Apache Thrift</a>
<a href='http://sunliwen.com/tag/lead%e9%98%b3%e5%85%89/'  class='tag-link-250 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>LEAD阳光</a>
<a href='http://sunliwen.com/tag/mongodb/'  class='tag-link-192 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>MongoDB</a>
<a href='http://sunliwen.com/tag/ubuntu/'  class='tag-link-190 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Ubuntu</a>
<a href='http://sunliwen.com/tag/ruby/'  class='tag-link-40 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Ruby</a>
<a href='http://sunliwen.com/tag/tips/'  class='tag-link-37 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Tips</a>
<a href='http://sunliwen.com/tag/2005/'  class='tag-link-34 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>2005</a>
<a href='http://sunliwen.com/tag/cygwin/'  class='tag-link-36 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Cygwin</a>
<a href='http://sunliwen.com/tag/squid/'  class='tag-link-185 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Squid</a>
<a href='http://sunliwen.com/tag/shell/'  class='tag-link-42 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Shell</a>
<a href='http://sunliwen.com/tag/programming/'  class='tag-link-54 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Programming</a>
<a href='http://sunliwen.com/tag/windows/'  class='tag-link-159 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Windows</a>
<a href='http://sunliwen.com/tag/rur-ple/'  class='tag-link-136 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>RUR-PLE</a>
<a href='http://sunliwen.com/tag/pragmatic/'  class='tag-link-174 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Pragmatic</a>
<a href='http://sunliwen.com/tag/wordpress/'  class='tag-link-55 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>Wordpress</a>
<a href='http://sunliwen.com/tag/swig/'  class='tag-link-75 nktagcloud-6' title='1' rel="tag" style='font-size: 6pt;'>SWIG</a></li>		<li id="recent-posts-3" class="widget widget_recent_entries">		<h2 class="widgettitle">近期文章</h2>		<ul>
					<li>
				<a href="http://sunliwen.com/2014/04/project-naptha-ocr-in-browser/">Project Naptha &#8211; 浏览器里的OCR</a>
						</li>
					<li>
				<a href="http://sunliwen.com/2013/08/neo4j-server-fail-to-start/">Neo4j Server启动失败</a>
						</li>
					<li>
				<a href="http://sunliwen.com/2012/03/ubuntu-vim-gbk/">Ubuntu下用Vim编辑且不改变GBK编码的文件</a>
						</li>
					<li>
				<a href="http://sunliwen.com/2012/02/apache-thrift-on-ubuntu-10-04/">笔记：Ubuntu下快速开始使用Python Thrift</a>
						</li>
					<li>
				<a href="http://sunliwen.com/2012/01/mac-ab-apr-error/">ab(Apache Benchmark)运行apr_socket_recv报错</a>
						</li>
					<li>
				<a href="http://sunliwen.com/2012/01/ubuntu-php-collision-workaround/">Ubuntu下PHP哈希冲突漏洞快修</a>
						</li>
				</ul>
		</li>		<li id="meta-7" class="widget widget_meta"><h2 class="widgettitle">功能</h2>			<ul>
						<li><a href="http://sunliwen.com/wp-login.php">登录</a></li>
			<li><a href="http://sunliwen.com/feed/">文章<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://sunliwen.com/comments/feed/">评论<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://cn.wordpress.org/" title="基于WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>			</ul>
			</li>		</ul>
	</div>


<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link somewhere on your blog is the best way; it's our only promotion or advertising. -->
	<p style="padding-top:5em">
		Powered by <a href="http://wordpress.org/">WordPress</a>
                 | <a href="http://www.azeemazeez.com/blogs/white-as-milk/" title="White as Milk theme for Wordpress">White as Milk</a> 
                 | <a href="http://sunliwen.com/white-as-milk" title="牛奶白">牛奶白</a> 
                 | <a href="http://www.linode.com/?r=714fb866f22e344dc0e37d23c13522e26505d459">Linode</a>
                 | <a href="http://db.tt/AiQlHuxW">Dropbox</a>
                 | <a href="http://sendgrid.tellapal.com/a/clk/23CThz">Sendgrid</a>
                 | <a href="http://creativecommons.org/licenses/by-nc-nd/2.5/cn/" title="署名-非商业性使用-禁止演绎 2.5 中国大陆 (CC BY-NC-ND 2.5)">CC BY-NC-ND 2.5</a>
		<!-- 67 queries. 0.236 seconds. -->
	</p>
</div>
</div>
		        <script type="text/javascript">
        // <![CDATA[
        var disqus_shortname = 'sunliwen';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1 && nodes[i].parentNode.tagName == 'A') {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        // ]]>
        </script>
        <!-- Powered by WPtouch: 4.3.19 --><div id="su-footer-links" style="text-align: center;"></div><script type='text/javascript' src='http://sunliwen.com/wp-content/plugins/wp-syntax/js/wp-syntax.js?ver=1.1'></script>
<script type='text/javascript' src='http://sunliwen.com/wp-includes/js/wp-embed.min.js?ver=fe7b40731312a61df5cf19937a0ef419'></script>


</body>
</html><!-- WP Fastest Cache file was created in 0.31470394134521 seconds, on 22-10-17 10:34:26 --><!-- via php -->